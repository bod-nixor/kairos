<!doctype html>
<html lang="en" data-theme="light">

<head>
  <meta charset="utf-8" />
  <title>Kairos ‚Äî Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Kairos academic platform ‚Äî your courses, queues, and progress." />
  <link rel="icon" type="image/png" href="./images/logo.png" />
  <!-- Theme flash prevention -->
  <script>
    (function () {
      try {
        var s = localStorage.getItem('kairos-theme');
        var dark = s === 'dark' || (!s && window.matchMedia('(prefers-color-scheme: dark)').matches);
        document.documentElement.dataset.theme = dark ? 'dark' : 'light';
      } catch (e) { }
    })();
  </script>
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/lms.css" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="./js/config.js"></script>
</head>

<body class="k-page-body k-pre-auth">

  <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <aside class="k-sidebar hidden" id="kSidebar" role="navigation" aria-label="Main navigation">
    <a class="k-sidebar__brand" href="/signoff/" data-home-link="true" aria-label="Kairos home">
      <div class="k-sidebar__logo">
        <img class="k-brand-badge" src="./images/logo.png" alt="" />
      </div>
      <span class="k-sidebar__wordmark">Kairo<span>s</span></span>
    </a>

    <div class="k-sidebar__scroll">
      <!-- Global nav (outside course) -->
      <nav class="k-nav-group" id="kNavGlobal" aria-label="Global">
        <button class="k-nav-item is-active" data-nav-key="dashboard" data-view="dashboard" aria-current="page">
          <span class="k-nav-item__icon" aria-hidden="true">‚äû</span>
          <span class="k-nav-item__text">Dashboard</span>
        </button>
        <!-- Rooms shortcut -->
        <button class="k-nav-item" data-nav-key="rooms" data-view="rooms" id="kRoomsNavBtn" disabled title="Select a course first">
          <span class="k-nav-item__icon" aria-hidden="true">üè´</span>
          <span class="k-nav-item__text">Rooms</span>
        </button>
      </nav>

      <!-- Role-specific nav items (hidden until caps loaded) -->
      <nav class="k-nav-group hidden" id="kNavRoles" aria-label="Role tools">
        <div class="k-nav-group__label">Tools</div>
        <a class="k-nav-item hidden" id="navTA" href="/signoff/ta" data-nav-key="ta">
          <span class="k-nav-item__icon" aria-hidden="true">üéì</span>
          <span class="k-nav-item__text">TA Dashboard</span>
        </a>
        <a class="k-nav-item hidden" id="navManager" href="/signoff/manager" data-nav-key="manager">
          <span class="k-nav-item__icon" aria-hidden="true">üìã</span>
          <span class="k-nav-item__text">Manager</span>
        </a>
        <a class="k-nav-item hidden" id="navAdmin" href="/signoff/admin" data-nav-key="admin">
          <span class="k-nav-item__icon" aria-hidden="true">‚öôÔ∏è</span>
          <span class="k-nav-item__text">Admin</span>
        </a>
      </nav>
    </div>

    <!-- User footer -->
    <div class="k-sidebar__user">
      <img class="k-sidebar__avatar" id="kSidebarAvatar" src="" alt="Your avatar" />
      <div class="k-sidebar__user-info">
        <div class="k-sidebar__user-name" id="kSidebarName">‚Äî</div>
        <div class="k-sidebar__user-role" id="kSidebarRole">Student</div>
      </div>
      <button class="k-sidebar__logout" id="kLogoutBtn" aria-label="Logout" title="Logout">‚Ü©</button>
    </div>
  </aside>

  <!-- ‚îÄ‚îÄ Main Layout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="k-layout">

    <!-- Topbar -->
    <header class="k-topbar hidden" id="kTopbar" role="banner">
      <nav class="k-breadcrumb" id="kBreadcrumb" aria-label="Breadcrumb">
        <span class="k-breadcrumb__item is-current">Dashboard</span>
      </nav>
      <div class="k-topbar__actions">
        <button class="k-topbar__icon-btn theme-toggle" id="themeToggle" aria-label="Toggle dark mode"
          data-theme-toggle>
          <span class="theme-toggle__icon theme-toggle__icon--sun" aria-hidden="true">‚òÄÔ∏è</span>
          <span class="theme-toggle__icon theme-toggle__icon--moon" aria-hidden="true">üåô</span>
        </button>
        
      </div>
    </header>

    <!-- Main Content -->
    <main class="k-main" id="appRoot">
      <div class="k-page">

        <!-- Sign-in screen -->
        <section id="signin" class="centerbox card" aria-label="Sign in">
          <img src="./images/logo-full.png" alt="Kairos" class="k-brand-badge signin-logo" />
          <h1 class="title" style="text-align:center;margin:0 0 16px">Welcome to Kairos</h1>
          <p class="muted small" style="text-align:center;margin:0 0 20px">Your academic operating system</p>
          <div id="googleBtn"></div>
          <p class="muted small" style="text-align:center;margin-top:12px">
            Only <strong data-allowed-domain-text>@nixorcollege.edu.pk</strong> accounts are allowed.
          </p>
        </section>

        <!-- Dashboard view -->
        <section id="viewDashboard" class="view hidden" aria-label="Dashboard">
          <div class="k-page-header">
            <div>
              <h1 class="k-page-header__title" id="dashGreeting">Good morning!</h1>
              <p class="k-page-header__subtitle">Here's what's happening across your courses.</p>
            </div>
          </div>

          <!-- Quick stats -->
          <div class="k-stats-row" id="dashStats">
            <div class="k-skeleton k-skeleton--card" style="height:100px"></div>
            <div class="k-skeleton k-skeleton--card" style="height:100px"></div>
            <div class="k-skeleton k-skeleton--card" style="height:100px"></div>
          </div>

          <!-- Course cards -->
          <div class="k-card">
            <div class="k-card__header">
              <h2 class="k-card__title">My Courses</h2>
            </div>
            <div class="k-card__body">
              <div id="coursesGrid"
                style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px">
                <div class="k-skeleton k-skeleton--card" style="height:200px"></div>
                <div class="k-skeleton k-skeleton--card" style="height:200px"></div>
                <div class="k-skeleton k-skeleton--card" style="height:200px"></div>
              </div>
            </div>
          </div>

          <div class="k-card" style="margin-top:16px">
            <div class="k-card__header">
              <h2 class="k-card__title">Available Courses</h2>
            </div>
            <div class="k-card__body">
              <div data-available-courses-grid="1" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px"></div>
            </div>
          </div>

        </section>

        <!-- Courses view (kept for nav compatibility) -->
        <section id="viewCourses" class="view hidden" aria-label="Courses">
          <div class="k-page-header">
            <h1 class="k-page-header__title">My Courses</h1>
          </div>
          <div id="coursesGridFull"
            style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px">
            <div class="k-skeleton k-skeleton--card" style="height:200px"></div>
          </div>

          <div class="k-card" style="margin-top:16px">
            <div class="k-card__header">
              <h2 class="k-card__title">Available Courses</h2>
            </div>
            <div class="k-card__body">
              <div data-available-courses-grid="1" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px"></div>
            </div>
          </div>

        </section>

        <!-- Rooms view -->
        <section id="viewRooms" class="view hidden" aria-label="Rooms">
          <div class="k-page-header">
            <div>
              <h1 class="k-page-header__title" id="roomsTitle">Rooms</h1>
            </div>
            <div class="k-page-header__actions">
              <button id="backToCourses" class="btn btn-ghost">‚Üê Back to Courses</button>
            </div>
          </div>
          <div id="roomsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px">
          </div>
          <section id="progressSection" class="hidden" style="margin-top:32px">
            <h2 style="font-size:22px;margin:0 0 16px">Your Progress</h2>
            <div id="progressContainer"></div>
          </section>
        </section>

      </div>
    </main>
  </div>

  <!-- TA accept modal (existing functionality preserved) -->
  <div id="taAcceptModal" class="modal hidden" role="alertdialog" aria-modal="true">
    <div class="modal-backdrop"></div>
    <div class="modal-card">
      <h3>You're up!</h3>
      <p><span id="taAcceptTAName">A TA</span> is ready to help you for queue <span id="taAcceptQueueId">?</span>.</p>
      <p class="small">Please head over to the TA or join the designated call.</p>
      <div class="modal-actions">
        <button id="taAcceptDismiss" class="btn btn-primary">Got it</button>
      </div>
    </div>
  </div>

  <!-- Toast stack (legacy) -->
  <div class="toast-stack" id="toastStack" aria-live="polite"></div>

  <!--
    Compatibility shim: old script.js references these IDs.
    They are hidden but keep script.js from crashing.
  -->
  <div id="userbar" class="hidden">
    <span id="name"></span>
  </div>
  <nav id="mainNav" class="hidden">
    <a id="navHomeLink" class="top-nav-link" data-view="home" href="#"></a>
    <a id="navCoursesLink" class="top-nav-link" data-view="courses" href="#"></a>
    <a id="navTaLink" class="top-nav-link" data-view="ta" href="#"></a>
    <a id="navManagerLink" class="top-nav-link" data-view="manager" href="#"></a>
    <a id="navAdminLink" class="top-nav-link" data-view="admin" href="#"></a>
  </nav>
  <span id="breadcrumbs" class="hidden"></span>
  <span id="navCourses" class="hidden"></span>
  <span id="navRooms" class="hidden"></span>
  <button id="logoutBtn" class="hidden"></button>

  <script src="./js/theme.js"></script>
  <script src="./js/ws.js"></script>
  <script src="./js/lms-core.js"></script>
  <script src="./js/lms-ws.js"></script>
  <script src="./script.js"></script>
  <script>
    /* Sidebar nav view switching ‚Äî bridge to script.js */
    document.addEventListener('DOMContentLoaded', function () {
      window.showKairosView = function (view) {
        if (view === 'dashboard' || view === 'courses') {
          // Both dashboard and courses render into viewDashboard
          if (typeof renderCourseCards === 'function') renderCourseCards();
          return;
        }
        if (view === 'rooms') {
          if (typeof showView === 'function') showView('viewRooms');
          return;
        }
        // Fallback for unknown views
        var mapped = 'view' + view.charAt(0).toUpperCase() + view.slice(1);
        if (typeof showView === 'function') showView(mapped);
      };

      const navBtns = document.querySelectorAll('.k-nav-item[data-view]');
      navBtns.forEach(function (btn) {
        btn.addEventListener('click', function () {
          const view = btn.dataset.view;
          navBtns.forEach(b => { b.classList.remove('is-active'); b.removeAttribute('aria-current'); });
          btn.classList.add('is-active');
          btn.setAttribute('aria-current', 'page');
          if (window.showKairosView) window.showKairosView(view);
        });
      });

      // Greeting
      const hour = new Date().getHours();
      const greetEl = document.getElementById('dashGreeting');
      if (greetEl) {
        greetEl.textContent = hour < 12 ? 'Good morning!' : hour < 17 ? 'Good afternoon!' : 'Good evening!';
      }
    });
  </script>
</body>

</html>