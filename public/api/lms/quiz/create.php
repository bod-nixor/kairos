<?php
declare(strict_types=1); require_once dirname(__DIR__) . '/_common.php'; $user=lms_require_roles(['manager','admin']); $in=lms_json_input();
$courseId=(int)($in['course_id']??0); if($courseId<=0||empty($in['title'])){lms_error('validation_error','course_id and title required',422);} $pdo=db();
$pdo->prepare('INSERT INTO lms_assessments (course_id,section_id,title,instructions,assessment_type,status,max_attempts,time_limit_minutes,available_from,due_at,created_by) VALUES (:c,:s,:t,:i,:ty,:st,:m,:tl,:af,:d,:u)')->execute([':c'=>$courseId,':s'=>isset($in['section_id'])?(int)$in['section_id']:null,':t'=>$in['title'],':i'=>$in['instructions']??null,':ty'=>$in['assessment_type']??'quiz',':st'=>$in['status']??'draft',':m'=>(int)($in['max_attempts']??1),':tl'=>isset($in['time_limit_minutes'])?(int)$in['time_limit_minutes']:null,':af'=>$in['available_from']??null,':d'=>$in['due_at']??null,':u'=>(int)$user['user_id']]); lms_ok(['quiz_id'=>(int)$pdo->lastInsertId()]);
